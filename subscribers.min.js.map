{"version":3,"file":"subscribers.min.js","sources":["_subscribers.js","utils/hasOwn.js","_hasDirectSubscribersFor.js","has.js","_hasSubscribers.js","emit.js","utils/guid.js","on.js","utils/isFunction.js","_removeSubscriber.js","off.js","_removeSubscriberByToken.js","once.js","utils/isString.js","get.js","utils/isToken.js","_getSubscriberByToken.js","_getSubscribers.js","_getAllSubscribers.js","remove.js","utils/isArray.js","_removeSubscribers.js","subscribers.js","notify.js","clear.js"],"sourcesContent":["/**\n * 存储订阅者（主题和处理器的）私有对象\n * ========================================================================\n * @type {{}}\n * @private\n */\nconst _subscribers = {}\n\nexport default _subscribers\n","/**\n * 检测对象自身属性中是否具有指定的属性。\n * ========================================================================\n * @method hasOwn\n * @param {Object} obj - （必须）检测的目标对象\n * @param {String} prop - （必须）属性名\n * @returns {Boolean}\n */\nconst hasOwn = (obj, prop) => {\n  const hasOwnProperty = Object.prototype.hasOwnProperty\n  return obj && hasOwnProperty.call(obj, prop)\n}\n\nexport default hasOwn\n","import _subscribers from './_subscribers'\nimport hasOwn from './utils/hasOwn'\n\n/**\n * 判断是否存在特定 topic 指定的订阅者信息\n * ========================================================================\n * @method _hasDirectSubscribersFor\n * @param {String} topic - （必须）主题名称\n * @returns {Boolean}\n */\nconst _hasDirectSubscribersFor = (topic) => {\n  return hasOwn(_subscribers, topic) && _subscribers[topic].length > 0\n}\n\nexport default _hasDirectSubscribersFor\n","import _hasDirectSubscribersFor from './_hasDirectSubscribersFor'\nimport _hasSubscribers from './_hasSubscribers'\n\n/**\n * 判断是否存在包含 topic 指定的订阅者信息\n * ========================================================================\n * @method has\n * @param {String} topic - （必须）主题名称\n * @param {Boolean} [isDirect] - （可选）是否为直接的主题，默认值：true\n * @returns {Boolean}\n */\nconst has = (topic, isDirect = true) => {\n  return isDirect ? _hasDirectSubscribersFor(topic) : _hasSubscribers(topic)\n}\n\nexport default has\n","import _hasDirectSubscribersFor from './_hasDirectSubscribersFor'\n\n/**\n * 判断是否存在包含 topic 指定的订阅者信息\n * ========================================================================\n * @method _hasSubscribers\n * @param {String} topic - （必须）主题名称\n * @returns {Boolean}\n */\nconst _hasSubscribers = (topic) => {\n  let found = _hasDirectSubscribersFor(topic)\n  let position = topic.lastIndexOf('.')\n\n  while (!found && position !== -1) {\n    topic = topic.substring(0, position)\n    position = topic.lastIndexOf('.')\n    found = _hasDirectSubscribersFor(topic)\n  }\n\n  return found\n}\n\nexport default _hasSubscribers\n","import _subscribers from './_subscribers'\nimport has from './has'\nimport _hasDirectSubscribersFor from './_hasDirectSubscribersFor'\n\n/**\n * （异步）发布订阅主题信息\n * ========================================================================\n * 主题默认是异步发布的。确保在消费者处理主题时，主题的发起者不会被阻止。\n * ========================================================================\n * @method emit\n * @param {String} topic - （必须）主题名称\n * @param {Object} data - （必须）数据对象\n * @param {Boolean} async - (可选) 是否异步发布\n */\nconst emit = (topic, data, async = true) => {\n  const execute = (topic) => {\n    if (!_hasDirectSubscribersFor(topic)) {\n      return false\n    }\n\n    _subscribers[topic].forEach((subscriber) => {\n      subscriber.callback(data)\n    })\n  }\n  const deliver = () => {\n    let subscriber = topic\n    let position = topic.lastIndexOf('.')\n\n    while (position !== -1) {\n      subscriber = subscriber.substring(0, position)\n      position = subscriber.lastIndexOf('.')\n\n      execute(subscriber)\n    }\n\n    execute(topic)\n  }\n\n  if (!has(topic)) {\n    return false\n  }\n\n  if (async) {\n    setTimeout(deliver, 10)\n  } else {\n    deliver()\n  }\n}\n\nexport default emit\n","/**\n * 生成唯一 id 字符串的函数\n * ========================================================================\n * @method guid\n * @param {String} [prefix] - 生成 id 的前缀字符串\n * @return {String} 返回一个\n */\nconst guid = (() => {\n  let id = 0\n\n  return (prefix = 'guid-') => {\n    id += 1\n\n    return `${prefix + id}`\n  }\n})()\n\nexport default guid\n","import _subscribers from './_subscribers'\nimport isFunction from './utils/isFunction'\nimport guid from './utils/guid'\n\n/**\n * 订阅主题，并给出处理器函数\n * ========================================================================\n * @method on\n * @param {String} topic - （必须）主题名称\n * @param {Function} handler - （必须）主题的处理器函数\n * @return {String|Boolean} - 唯一的 token 字符串，例如：'guid-1'。\n */\nconst on = (topic, handler) => {\n  const token = guid()\n\n  if (!isFunction(handler)) {\n    return false\n  }\n\n  /* istanbul ignore else */\n  if (!_subscribers[topic]) {\n    _subscribers[topic] = []\n  }\n\n  _subscribers[topic].push({\n    topic,\n    callback: handler,\n    token\n  })\n\n  return token\n}\n\nexport default on\n","/**\n * 检测测试数据是否为 Function 类型\n * ========================================================================\n * @method isFunction\n * @param {*} val - （必须）待检测的数据\n * @returns {Boolean} 'val' 是 Function 类型返回 true，否则返回 false\n */\nconst isFunction = (val) => {\n  return Object.prototype.toString.apply(val) === '[object Function]'\n}\n\nexport default isFunction\n","import _subscribers from './_subscribers'\nimport hasOwn from './utils/hasOwn'\n\n/**\n * 删除特定 topic 主题的订阅者信息\n * ========================================================================\n * @method _removeSubscriber\n * @param {String} topic - （必须）主题名称\n * @returns {Boolean}\n */\nconst _removeSubscriber = (topic) => {\n  if (!hasOwn(_subscribers, topic)) {\n    return false\n  }\n\n  delete _subscribers[topic]\n}\n\nexport default _removeSubscriber\n","import has from './has'\nimport _removeSubscriber from './_removeSubscriber'\nimport _removeSubscriberByToken from './_removeSubscriberByToken'\n\n/**\n * 取消订阅主题\n * ========================================================================\n * @method off\n * @param {String} topic - （必须）订阅的主题\n * @param {Function|String} [token] - （可选）订阅主题的处理器函数或者唯一 Id 值\n */\nconst off = (topic, token) => {\n  if (!has(topic)) {\n    return false\n  }\n\n  if (token) {\n    _removeSubscriberByToken(token)\n  } else {\n    _removeSubscriber(topic)\n  }\n}\n\nexport default off\n","import _subscribers from './_subscribers'\nimport _removeSubscriber from './_removeSubscriber'\n\nconst _removeSubscriberByToken = (token) => {\n  const keys = Object.keys(_subscribers)\n  let index = -1\n\n  if (!token || keys.length < 1) {\n    return false\n  }\n\n  keys.forEach((prop) => {\n    const subscriber = _subscribers[prop]\n    let topic\n    subscriber.forEach((subject, j) => {\n      if (subject.callback === token || subject.token === token) {\n        topic = subject.topic\n        subscriber.splice(index, j)\n      }\n    })\n\n    /* istanbul ignore else */\n    if (subscriber.length < 1) {\n      _removeSubscriber(topic)\n    }\n  })\n}\n\nexport default _removeSubscriberByToken\n","import on from './on'\nimport off from './off'\n\n/**\n * 订阅主题，并给出处理器函数，接受到消息后，仅执行一次\n * ========================================================================\n * @method once\n * @param {String} topic - （必须）主题名称\n * @param {Function} handler - （必须）主题的处理器函数\n * @return {String|Boolean} - 唯一的 token 字符串，例如：'guid-1'。\n */\nconst once = (topic, handler) => {\n  return on(topic, function () {\n    off(topic, handler)\n    handler.apply(this, arguments)\n  })\n}\n\nexport default once\n","const isString = (str) => {\n  return typeof str === 'string'\n}\n\nexport default isString\n","import _subscribers from './_subscribers'\nimport isToken from './utils/isToken'\nimport isString from './utils/isString'\nimport _getAllSubscribers from './_getAllSubscribers'\nimport _getSubscribers from './_getSubscribers'\nimport _getSubscriberByToken from './_getSubscriberByToken'\n\n/**\n * 获取全部或者包含 topic 主题或者订阅 token 的订阅者信息\n * ========================================================================\n * @method get\n * @param {String} [topic] - （可选）主题名称或者订阅 token 值\n *                            传递 topic 参数，返回包含 topic 主题的订阅者信息\n *                            不传递 topic 参数，返回全部订阅者信息\n * @returns {Array|Object}\n */\nconst get = (topic) => {\n  const keys = Object.keys(_subscribers)\n\n  if (keys.length < 1) {\n    return []\n  }\n\n  if (!topic) {\n    return _getAllSubscribers()\n  } else {\n    if (isToken(topic)) {\n      return _getSubscriberByToken(topic)\n    } else if (isString(topic)) {\n      return _getSubscribers(topic)\n    }\n  }\n}\n\nexport default get\n","const isToken = (str) => {\n  const pattern = /^guid-\\d+$/i\n  return pattern.test(str)\n}\n\nexport default isToken\n","import _subscribers from './_subscribers'\n\nconst _getSubscriberByToken = (token) => {\n  const keys = Object.keys(_subscribers)\n  let observer = null\n\n  if (keys.length < 1) {\n    return null\n  }\n\n  _subscribers.forEach((subscriber) => {\n    subscriber.forEach((subject) => {\n      if (subject.callback === token || subject.token === token) {\n        observer = subscriber\n      }\n    })\n  })\n\n  return observer\n}\n\nexport default _getSubscriberByToken\n","import hasOwn from './utils/hasOwn'\nimport _subscribers from './_subscribers'\n\nconst _getSubscribers = (topic) => {\n  const keys = Object.keys(_subscribers)\n  let subscribers = []\n\n  if (keys.length < 1) {\n    return subscribers\n  }\n\n  keys.forEach((subject) => {\n    const observer = {}\n    if (hasOwn(_subscribers, subject) && subject.startsWith(topic)) {\n      observer[subject] = _subscribers[subject]\n      subscribers.push(observer)\n    }\n  })\n\n  return subscribers\n}\n\nexport default _getSubscribers\n","import _subscribers from './_subscribers'\n\nconst _getAllSubscribers = () => {\n  return _subscribers\n}\n\nexport default _getAllSubscribers\n","import _removeSubscriber from './_removeSubscriber'\nimport _removeSubscribers from './_removeSubscribers'\nimport isArray from './utils/isArray'\nimport isString from './utils/isString'\n\n/**\n * 删除特定 topic 主题的订阅者信息。\n * ========================================================================\n * methods\n * @param {String|Array} topic\n */\nconst remove = (topic) => {\n  if (isArray(topic)) {\n    _removeSubscribers(topic)\n  } else {\n    if (isString(topic)) {\n      _removeSubscriber(topic)\n    }\n  }\n}\n\nexport default remove\n","/**\n * 检测测试数据是否为 Array 类型\n * ========================================================================\n * @method isArray\n * @param {*} val - 要检测的数据\n * @returns {Boolean} - 'val' 是 Array 则返回 true，否则返回 false\n */\nconst isArray = (val) => {\n  const toString = Object.prototype.toString\n  return Array.isArray\n    ? Array.isArray(val)\n    : toString.apply(val) === '[object Array]'\n}\n\nexport default isArray\n","import _subscribers from './_subscribers'\nimport hasOwn from './utils/hasOwn'\nimport has from './has'\n\n/**\n * 删除包含 topic 主题的订阅者信息\n * ========================================================================\n * @method _removeSubscribers\n * @param {String} topic - （必须）主题名称\n * @returns {Boolean}\n */\nconst _removeSubscribers = (topic) => {\n  if (!has(topic)) {\n    return false\n  }\n\n  Object.keys(_subscribers).forEach((subscriber) => {\n    if (hasOwn(_subscribers, subscriber) && subscriber.indexOf(topic) === 0) {\n      delete _subscribers[subscriber]\n    }\n  })\n}\n\nexport default _removeSubscribers\n","import emit from './emit'\nimport notify from './notify'\nimport on from './on'\nimport off from './off'\nimport once from './once'\nimport get from './get'\nimport has from './has'\nimport remove from './remove'\nimport clear from './clear'\n\nconst subscribers = {\n  /**\n   * 订阅主题，并给出处理器函数\n   * ========================================================================\n   * @method on\n   * @param {String} topic - （必须）主题名称\n   * @param {Function} handler - （必须）主题的处理器函数\n   * @return {String|Boolean} -\n   */\n  on(topic, handler) {\n    return on(topic, handler)\n  },\n\n  /**\n   * 订阅主题，并给出处理器函数，接受到消息后，仅执行一次\n   * ========================================================================\n   * @method once\n   * @see once\n   * @param {String} topic - （必须）主题名称\n   * @param {Function} handler - （必须）主题的处理器函数\n   * @return {String|Boolean}\n   */\n  once(topic, handler) {\n    return once(topic, handler)\n  },\n\n  /**\n   * 发布订阅主题信息\n   * ========================================================================\n   * @method emit\n   * @see emit\n   * @param {String} topic - （必须）主题名称\n   * @param {Object} data - （必须）数据对象\n   * @param {Boolean} async - (可选) 是否异步发布\n   * @returns {subscribers}\n   */\n  emit(topic, data, async = true) {\n    emit(topic, data, async)\n\n    return this\n  },\n\n  /**\n   * 同步发布订阅主题信息\n   * ========================================================================\n   * @method notify\n   * @alias emit\n   * @see emit\n   * @param {String} topic - （必须）主题名称\n   * @param {Object} data - （必须）数据对象\n   * @returns {subscribers}\n   */\n  notify(topic, data) {\n    notify(topic, data)\n\n    return this\n  },\n\n  /**\n   * 取消订阅主题\n   * ========================================================================\n   * @method off\n   * @see off\n   * @param {String} topic - （必须）订阅的主题\n   * @param {Function|String} [token] - （可选）订阅主题的处理器函数或者唯一 Id 值\n   * @returns {subscribers}\n   */\n  off(topic, token) {\n    off(topic, token)\n\n    return this\n  },\n\n  /**\n   * 获取全部或者包含 topic 主题的订阅者信息\n   * ========================================================================\n   * @method get\n   * @param {String} [topic] - （可选）主题名称\n   *                            传递 topic 参数，返回包含 topic 主题的订阅者信息\n   *                            不传递 topic 参数，返回全部订阅者信息\n   * @returns {*[]}\n   */\n  get(topic) {\n    return get(topic)\n  },\n\n  /**\n   * 判断是否存在包含 topic 指定的订阅者信息\n   * ========================================================================\n   * @method has\n   * @see _hasSubscribers\n   * @see _hasDirectSubscribersFor\n   * @param {String} topic - （必须）主题名称\n   * @param {Boolean} [isDirect] -（可选）是否为直接的主题，默认值：true\n   * @returns {Boolean}\n   */\n  has(topic, isDirect = true) {\n    return has(topic, isDirect)\n  },\n\n  /**\n   * 删除特定 topic 或者多个主题的订阅者信息\n   * ========================================================================\n   * @method remove\n   * @see _removeSubscriber\n   * @see _removeSubscribers\n   * @param {String|Array} topic - （必须）主题名称\n   * @returns {subscribers}\n   */\n  remove(topic) {\n    remove(topic)\n\n    return this\n  },\n\n  /**\n   * 清理所有订阅者（主题和处理器的）信息\n   * ========================================================================\n   * @method clear\n   * @see clear\n   * @returns {subscribers}\n   */\n  clear() {\n    clear()\n\n    return this\n  }\n}\n\nexport default subscribers\n","import emit from './emit'\n\n/**\n * 同步发布订阅主题信息\n * ========================================================================\n * @method notify\n * @alias emit\n * @param {String} topic - （必须）主题名称\n * @param {Object} data - （必须）数据对象\n */\nconst notify = (topic, data) => {\n  emit(topic, data, false)\n}\n\nexport default notify\n","import _subscribers from './_subscribers'\n\n/**\n * 清理所有订阅者（主题和处理器的）信息\n * ========================================================================\n * @method clear\n */\nconst clear = () => {\n  const keys = Object.keys(_subscribers)\n\n  if (keys.length < 1) {\n    return false\n  }\n\n  keys.forEach((prop) => {\n    delete _subscribers[prop]\n  })\n}\n\nexport default clear\n"],"names":["_subscribers","hasOwn","obj","prop","hasOwnProperty","Object","prototype","call","_hasDirectSubscribersFor","topic","length","has","isDirect","found","position","lastIndexOf","substring","_hasSubscribers","emit","data","async","execute","forEach","subscriber","callback","deliver","setTimeout","guid","id","prefix","on","handler","token","val","toString","apply","push","_removeSubscriber","off","keys","subject","j","splice","_removeSubscriberByToken","once","this","arguments","isString","str","get","test","observer","_getSubscriberByToken","subscribers","startsWith","_getSubscribers","remove","Array","isArray","indexOf","_removeSubscribers","notify","clear"],"mappings":"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"}